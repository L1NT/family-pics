<!DOCTYPE html>
<html>
<!-- main.html -->
   <head>
      <meta charset="utf-8" />
      <title>Jeter Family Pictures</title>
      <link rel="stylesheet" type="text/css" href="pic.css" />
      <link rel="stylesheet" href="thirdparty/fancybox/source/jquery.fancybox.css?v=2.1.0" type="text/css" media="screen" />
      <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
      <script type="text/javascript" src="thirdparty/fancybox/source/jquery.fancybox.pack.js?v=2.1.0"></script>
      <script type="text/javascript" src="thirdparty/fancybox/lib/jquery.mousewheel-3.0.6.pack.js"></script>
      <script type="text/javascript">
         var picServiceURL = 'webservice/familypics.py';
         var currPath = '/';
         var currIndex = '0';
        
         function getDirectories(path) {
            var dataString = 'function=get_directories&path=' + path;
            var subdirectories = Array(); 
            $.ajax({
               async: false,
               url: picServiceURL,
               data: dataString,
               success: function(data) {
                  //$('#title').html('<a href=\"' + picService + '?function=get_directories&path=' + data[0] + '\" target=\"thumbnails\">'+ data[0] +'</a><br />');
                  //$('#subtitle').html('');
                  //for(var i=1; i<data.length; i++)
                  //   $('#subtitle').append('<a href=\"' + picService + '?function=get_directories&path='+ data[0] +'\" target=\"thumbnails\">'+ data[0] +'</a>/&nbsp;&nbsp;');
                  data.slice(0,-1);
                  subdirectories = data.split("|");
               },
               error: function() {
                  alert('There was an error retreiving the list of subdirectories.');
               }
            })
            return subdirectories;
         }
         function getThumb(path) {
           var dataString = 'function=get_thumbnail&path=' + path;
           var thumb = '';
           $.ajax({
             url: picServiceURL,
             data: dataString,
             success: function(data) {
               thumb = data;
             }
           })
           return thumb;
         }
         
         function loadThumbnails(path) {
           var dataString = 'function=get_thumbnails&path=' + path;
           currPath = path + '/';
           subDirectories = getDirectories(currPath);
           subHeadingText = path + ': ';
           for (var i=0; i<subDirectories.length; i++) {
             subHeadingText += '<a href="#" onclick="loadThumbnails(\'' + path + '/' + subDirectories[i] + '\')">' + subDirectories[i] + '</a>&nbsp&nbsp&nbsp';
           }
           $('#subtitle').html(subHeadingText);
           $.ajax({
             async: false,
             url: picServiceURL,
             data: dataString,
             success: function(data) {
               data.slice(0,-1);
               thumbs = data.split("|");
               var table = $('table#thumbnails');
               table.empty();
               for (var i=0; i<thumbs.length; i++) {
                 if (i%4 == 0)
                    table.append('<tr>');
                //could maybe search 'tr a[href=*MPG]' and .addClass("movie")?
                //jQuery would need to accept regular expressions or three searches would
                //be needed.
                 if (thumbs[i].indexOf(".MPG") > -1 ||
                     thumbs[i].indexOf(".MOV") > -1 ||
                     thumbs[i].indexOf(".3gp") > -1)
                    table.find('tr:last').append('<td class="movie">' + thumbs[i] + '</td>');
                 else
                    table.find('tr:last').append('<td>' + thumbs[i] + '</td>');    
                 if (i%4 == 3)
                    table.append('</tr>');
               }
             }
           })
         }
        
         function getQuantity(path) {
         
         }
        
         function loadPic(url) {
           
         }

        //this has to follow any functions that it calls!
         $(document).ready(function() {
            $(".fbox").fancybox();
            
            //add the initial nav bar items
            $('nav ul')
               .each(
                  function() {
                     var directories = getDirectories('/');
                     for (var i=0; i<directories.length; i++) {
                        $(this).append('<li><a href="#" onclick="loadThumbnails(\'' + directories[i] + '\')">' + directories[i] + '</a></li>');
                     };
                  }
               );
               
            //add the nav bar hover functionality
            $('nav')
               .hover(
                  function() {
                     $('nav').css('overflow', 'auto');
                     $('div#arrows').hide();
                     $(this).stop().animate(
                        {
                           left: '0',
                           backgroundColor: '#f00'
                        },
                        750
                        //'swing' is default, 'linear' is the only other option
                     );
                  },
                  function() {
                     $('nav').css('overflow', 'hidden');
                     $('div#arrows').show();
                     $(this).stop().animate(
                        {
                           left: '-155px',
                           backgroundColor: '#666'
                        },
                        1500,
                        'linear'
                     );
                  }
               );
         });
    </script>
  </head>

  <body class="index">
    <nav>
        <div id="arrows"><b>&gt;&gt;</b></div>
        <ul><!-- this will hold the list of links --></ul>
    </nav>
    <hgroup>
      <h1 id="title">Jeter Family Digital Photo Album</h1>
      <h2 id="subtitle">(select a folder from the pullout menu to the left)</h2>
    </hgroup>
    <table id="thumbnails" border="3"></table>
  </body>
</html>
